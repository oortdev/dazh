<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Dashboard Items</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/static/dashboard.css">
<style>
body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    color: var(--text);
    background: {{ .Theme.BackgroundColor }}
        {{ if .Theme.BackgroundImage }} url('{{ .Theme.BackgroundImage }}') center/cover no-repeat{{ end }};
}

/* TOP MENU BAR */
.top-bar {
    width: 100%;
    background: {{ .Theme.MenuColor }};
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.top-bar button {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    background: var(--accent);
    color: #020617;
    font-weight: bold;
    cursor: pointer;
}

.top-bar button:hover {
    background: #0ea5e9;
}

/* FILTER DROPDOWN */
.filter {
    margin: 16px 20px;
    text-align: right;
}

.filter select {
    padding: 6px 10px;
    border-radius: 6px;
    border: none;
    background: #334155;
    color: var(--text);
    cursor: pointer;
}

/* THEME SETTINGS TABLE */
.theme-settings {
    max-width: 600px;
    margin: 20px auto;
    border-collapse: collapse;
    width: 100%;
}

.theme-settings td {
    padding: 6px;
}

/* ITEMS TABLE */
table { 
    border-collapse: collapse; 
    width: 100%; 
    max-width: 1200px; 
    margin: 20px auto; 
}
th, td { 
    padding: 6px; 
    border: 1px solid #334155; 
}
input[type=text], input[type=url] { width: 100%; }
input[type=color] { width: 60px; }

.add-row { 
    margin: 12px auto; 
    cursor: pointer; 
    color: var(--accent); 
    font-weight: bold; 
    text-align: center; 
}
.add-row:hover { text-decoration: underline; }

.buttons { 
    margin: 12px 0; 
    display: flex; 
    gap: 10px; 
    justify-content: center; 
}
button.save-btn { 
    background: var(--accent); 
    color: #020617; 
}
button.save-btn:hover { 
    background: #0ea5e9; 
}
button:disabled { 
    background: #64748b; 
    cursor: not-allowed; 
}
</style>
</head>
<body>

<!-- TOP MENU BAR -->
<div class="top-bar">
    <div>Manage Dashboard Items</div>
    <div>
        <button onclick="window.location='/'">â¬… Return</button>
    </div>
</div>

<!-- FILTER DROPDOWN -->
<div class="filter">
    <form method="get">
        <label>
            Filter by group:
            <select name="group" onchange="this.form.submit()">
                <option value="">All</option>
                {{ range .AllGroups }}
                    <option value="{{ . }}" {{ if eq $.SelectedGrp . }}selected{{ end }}>{{ . }}</option>
                {{ end }}
            </select>
        </label>
    </form>
</div>

<!-- THEME SETTINGS -->
<h2 style="text-align:center; color: var(--text);">Theme Settings</h2>
<form method="post" action="/save" id="manageForm">
<table class="theme-settings">
<tr>
    <td>Background color</td>
    <td><input type="color" name="background_color" value="{{ .Theme.BackgroundColor }}"></td>
</tr>
<tr>
    <td>Menu / tile color</td>
    <td><input type="color" name="menu_color" value="{{ .Theme.MenuColor }}"></td>
</tr>
<tr>
    <td>Background image URL</td>
    <td><input type="text" name="background_image" value="{{ .Theme.BackgroundImage }}"></td>
</tr>
</table>

<!-- ITEMS TABLE -->
<table id="itemsTable">
<tr>
  <th>Delete</th><th>Name</th><th>URL</th><th>Group</th><th>Color</th>
</tr>
{{ range .Items }}
<tr>
  <td><input type="checkbox" name="id_{{ .ID }}_delete"></td>
  <td><input type="text" name="id_{{ .ID }}_name" value="{{ .Name }}"></td>
  <td><input type="url" name="id_{{ .ID }}_url" value="{{ .URL }}"></td>
  <td><input type="text" name="id_{{ .ID }}_group" value="{{ .Group }}"></td>
  <td><input type="color" name="id_{{ .ID }}_color" value="{{ .Color }}"></td>
</tr>
{{ end }}
<!-- initial single new row -->
<tr class="new-row">
  <td>New</td>
  <td><input type="text" name="new_name[]"></td>
  <td><input type="url" name="new_url[]"></td>
  <td><input type="text" name="new_group[]"></td>
  <td><input type="color" name="new_color[]" value="#38bdf8"></td>
</tr>
</table>

<div class="add-row" onclick="addNewRow()">âž• Add another row</div>

<div class="buttons">
  <button type="submit" id="saveBtn" class="save-btn" disabled>ðŸ’¾ Save Changes</button>
</div>
</form>

<script>
const form = document.getElementById('manageForm');
const saveBtn = document.getElementById('saveBtn');

// Enable Save button when anything changes
form.addEventListener('input', () => {
    saveBtn.disabled = false;
});

// Add new empty row to items table
function addNewRow() {
    const table = document.getElementById('itemsTable');
    const row = document.createElement('tr');
    row.classList.add('new-row');
    row.innerHTML = `
      <td>New</td>
      <td><input type="text" name="new_name[]"></td>
      <td><input type="url" name="new_url[]"></td>
      <td><input type="text" name="new_group[]"></td>
      <td><input type="color" name="new_color[]" value="#38bdf8"></td>
    `;
    table.appendChild(row);
    saveBtn.disabled = false;
}
</script>

</body>
</html>

