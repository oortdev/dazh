<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Dashboard Items</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/static/dashboard.css">
<style>
body { display:flex; flex-direction: column; align-items: center; }
h1 { margin-top: 20px; color: var(--text); }
table { border-collapse: collapse; width: 100%; max-width: 1000px; }
th, td { padding: 6px; border: 1px solid #334155; text-align:center; }
input[type=text], input[type=url], input[type=color], input[type=file] { width: 100%; }
.color { width: 60px; }
.filter { margin-bottom: 12px; }
.buttons { margin: 12px 0; display: flex; gap: 10px; }
button { padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer; background: var(--accent); color: #020617; transition: background 0.2s; }
button:hover:enabled { background: #0ea5e9; }
button:disabled { background: #64748b; cursor: not-allowed; }
.add-row { margin-top: 12px; cursor: pointer; color: var(--accent); font-weight: bold; }
.add-row:hover { text-decoration: underline; }
.theme { margin-top: 20px; max-width: 1000px; display: flex; flex-direction: column; gap: 8px; }
#manageForm { margin-top: 70px; width: 100%; max-width: 1000px; }
img { max-height: 40px; display: block; margin: 4px auto; }
.top-bar img { max-height: 100px; }
</style>
</head>
<body>

<!-- Top Menu -->
<div class="top-bar">
    <div><img src="/static/dazh-logo.png" height="100px" width="150px" alt="dazh logo" ></div>
    <div>Dashboard Manager</div>
    <div>
        <button onclick="window.location='/'">â¬… Dashboard</button>
    </div>
</div>

<h1>Manage Dashboard Items</h1>

<!-- Filter by group -->
<div class="filter">
  <form method="get">
    <label>Filter by group:
      <select name="group" onchange="this.form.submit()">
        <option value="">All</option>
        {{ range .AllGroups }}
          <option value="{{ . }}" {{ if eq $.SelectedGrp . }}selected{{ end }}>{{ . }}</option>
        {{ end }}
      </select>
    </label>
  </form>
</div>

<form method="post" action="/save" id="manageForm" enctype="multipart/form-data">
<table id="itemsTable">
<tr>
  <th>Delete</th><th>Name</th><th>URL</th><th>Group</th><th>Color</th><th>Tile Image</th>
</tr>
{{ range .Items }}
<tr>
  <td><input type="checkbox" name="id_{{ .ID }}_delete"></td>
  <td><input type="text" name="id_{{ .ID }}_name" value="{{ .Name }}"></td>
  <td><input type="url" name="id_{{ .ID }}_url" value="{{ .URL }}"></td>
  <td><input type="text" name="id_{{ .ID }}_group" value="{{ .Group }}"></td>
  <td><input type="color" name="id_{{ .ID }}_color" value="{{ .Color }}" class="color"></td>
  <td>
    {{ if .Image }}
      <img src="{{ .Image }}">
    {{ end }}
    <input type="file" name="id_{{ .ID }}_file">
    <input type="hidden" name="id_{{ .ID }}_image" value="{{ .Image }}">
  </td>
</tr>
{{ end }}

<!-- New row template -->
<tr class="new-row">
  <td>New</td>
  <td><input type="text" name="new_name[]"></td>
  <td><input type="url" name="new_url[]"></td>
  <td><input type="text" name="new_group[]"></td>
  <td><input type="color" name="new_color[]" class="color" value="#38bdf8"></td>
  <td><input type="file" name="new_file[]"></td>
</tr>
</table>

<div class="add-row" onclick="addNewRow()">âž• Add another row</div>

<!-- Theme settings -->
<div class="theme">
  <h2>Theme Settings</h2>
  <label>Background Color: <input type="color" name="background_color" value="{{ .Theme.BackgroundColor }}"></label>
  <label>Menu Color: <input type="color" name="menu_color" value="{{ .Theme.MenuColor }}"></label>
  <label>Background Image URL: <input type="text" name="background_image" value="{{ .Theme.BackgroundImage }}"></label>
  <label>Upload Background Image: <input type="file" name="background_file"></label>
</div>

<div class="buttons">
  <button type="submit" id="saveBtn" disabled>ðŸ’¾ Save Changes</button>
  <button type="button" onclick="window.location='/'">â¬… Return</button>
</div>
</form>

<script>
const form = document.getElementById('manageForm');
const saveBtn = document.getElementById('saveBtn');

// Enable Save button on any change
form.addEventListener('input', () => { saveBtn.disabled = false; });

// Add new row dynamically
function addNewRow() {
  const table = document.getElementById('itemsTable');
  const row = document.createElement('tr');
  row.classList.add('new-row');
  row.innerHTML = `
    <td>New</td>
    <td><input type="text" name="new_name[]"></td>
    <td><input type="url" name="new_url[]"></td>
    <td><input type="text" name="new_group[]"></td>
    <td><input type="color" name="new_color[]" class="color" value="#38bdf8"></td>
    <td><input type="file" name="new_file[]"></td>
  `;
  table.appendChild(row);
  saveBtn.disabled = false;
}
</script>
</body>
</html>
